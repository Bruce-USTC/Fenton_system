
# Fenton system - 智能控制与监测系统

这是一个基于 Python 和 PyQt5 开发的桌面应用程序，旨在通过 **Modbus RTU** 协议，对多路传动泵和传感器进行实时的参数配置、状态控制、数据监测和可视化分析。

## ✨ 主要功能

  - **多窗口模块化设计**

      - **调试模式**: 功能齐全的串口助手，支持HEX/文本收发、CRC-16校验、时间戳和日志保存。
      - **控制模式**: 强大的批量控制面板，可对多达16个传动泵和10个传感器进行参数配置和启停控制。
      - **观测窗口**: 实时的数据可视化中心，用于监控设备的历史与当前状态。

  - **强大的设备控制**

      - 支持对16个传动泵进行**精准批量控制**，可通过复选框自由选择操作对象。
      - 可独立设置每个泵的从机地址和目标转速。
      - 支持全局的**启动**、**停止**和**正/反转**控制。

  - **实时数据监控与分析**

      - **定时轮询**传感器数据（当前支持pH值），并在仪表盘上实时显示。
      - 所有历史数据自动存储到本地 **SQLite** 数据库 (`fendun_data.db`) 中。
      - 在“观测窗口”中，可通过**表格**查看所有历史记录。
      - 支持将指定设备的数据绘制成**带实际时间坐标轴的实时折线图**。
      - 支持将表格数据或图表数据**导出为CSV文件**，方便在Excel等工具中进行离线分析。

## 📸 应用截图

## 🛠️ 技术架构

本系统采用模块化的设计思想，主要文件结构如下：

  - `main.py`: **主程序入口**。负责创建主窗口、管理三个子页面的切换，并处理程序级的事件（如关闭窗口）。
  - `debugmodel.py`: **调试模式**页面的全部逻辑实现。
  - `controlmodel.py`: **控制模式**页面的全部逻辑实现，包括设备控制和数据采集。
  - `watchwindow.py`: **观测窗口**页面的全部逻辑实现，包括数据库查询和图表绘制。
  - `database_manager.py`: 独立的**数据库管理模块**，封装了所有SQLite数据库的操作。
  - `FD*.py`: 由Qt Designer (`.ui`文件) 自动生成的UI定义文件。
  - `requirements.txt`: 项目的Python依赖库清单。

## 🚀 安装与运行

请按照以下步骤在您的电脑上部署和运行本项目。

**1. 克隆或下载项目**

将本项目的所有文件下载到您的本地文件夹中。

**2. 创建并激活虚拟环境 (推荐)**

为了保持项目依赖的纯净，建议使用虚拟环境。

```bash
# 进入项目根目录
cd /path/to/your/project

# 创建一个名为 venv 的虚拟环境
python -m venv venv

# 激活虚拟环境
# Windows:
venv\Scripts\activate
# macOS / Linux:
# source venv/bin/activate
```

**3. 安装依赖**

使用 `pip` 和 `requirements.txt` 文件一键安装所有必需的库。

```bash
pip install -r requirements.txt
```

**4. 运行程序**

确保您的硬件设备已通过串口连接到电脑，然后在项目根目录下运行 `main.py`。

```bash
python main.py
```

## 📖 使用指南

1.  首先在 **【调试模式】** 页面，从下拉框中选择正确的串口号，设置好波特率等参数，然后点击 **“打开串口”**。
2.  切换到 **【控制模式】** 页面，根据您的设备配置，填写好传动泵和传感器的从机地址。
3.  勾选您想要操作的传动泵或想要读取的传感器旁边的**启用复选框**。
4.  点击 **“启动”**、**“停止”** 或 **“正/反转”** 按钮来控制已勾选的设备。
5.  勾选 **“保存数据到数据库”** 复选框后，程序将每2秒自动记录一次所有设备的状态。
6.  切换到 **【观测窗口】** 页面：
      - 表格中会实时显示所有存入数据库的历史数据。
      - 在下拉框中选择您感兴趣的设备。
      - 勾选 **“折线图”** 复选框，即可看到该设备数据的实时可视化图表。
      - 点击 **“导出数据”** 可将当前表格或图表的数据保存为CSV文件。

## 📝 未来的改进方向 (TODO)

  - **架构优化**: 将串口的读写操作从主线程分离到独立的 `QThread` 中，以应对更高频率的数据收发，保证UI绝对流畅。
  - **功能完善**: 增加对传感器温度和ORP值的读取、显示和绘图。
  - **交互增强**: 为“观测窗口”的表格增加按时间筛选、排序等功能。

## 📄 开源许可

本项目采用 [MIT License](https://www.google.com/search?q=LICENSE) 开源许可。

## 📧 联系方式

  - **作者**: Bruce Lee (USTC)
  - **联系邮箱**: *lishengsheng@mail.ustc.edu.cn* 